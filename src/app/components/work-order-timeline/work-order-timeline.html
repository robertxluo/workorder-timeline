<div class="timeline-container">
  <!-- Header -->
  <header class="timeline-header">
    <div class="header-left">
      <img src="logo.svg" alt="Naologic" class="logo" />
    </div>
  </header>

  <!-- Timeline Body -->
  <h1 class="timeline-title">Work Orders</h1>
  <div class="controls">
    <label for="timescale">Timescale:</label>
    <select id="timescale" (change)="onZoomChange($event)" [value]="zoomLevel">
      <option value="day">Day</option>
      <option value="week">Week</option>
      <option value="month">Month</option>
    </select>
  </div>
  <div class="timeline-body">
    <!-- Fixed Left Column: Work Centers -->
    <div class="work-centers-col">
      <div class="wc-header">Work Center</div>
      <div class="wc-list">
        <div class="wc-row" *ngFor="let wc of workCenters; trackBy: trackByDocId">
          {{ wc.data.name }}
        </div>
      </div>
    </div>

    <!-- Scrollable Right Area: Timeline -->
    <div class="timeline-grid-area" #gridArea>
      <div class="grid-header">
        <div
          class="grid-column-label"
          *ngFor="let col of columns; trackBy: trackByColumn"
          [style.width.px]="col.width"
        >
          {{ col.label }}
        </div>
      </div>

      <div class="grid-body" [style.width.px]="totalWidth" style="min-width: 100%">
        <!-- Vertical Grid Lines -->
        <div class="vertical-grid-lines">
          <div
            class="v-line"
            *ngFor="let col of columns; trackBy: trackByColumn"
            [style.width.px]="col.width"
          ></div>
        </div>

        <!-- Today Indicator -->
        <div class="today-indicator" [style.left.px]="todayOffset"></div>

        <!-- Placeholder rows corresponding to work centers -->
        <div
          class="grid-row"
          [class.has-active-menu]="hasActiveOrderWithMenu(wc.docId)"
          *ngFor="let wc of workCenters; trackBy: trackByDocId"
          (click)="onGridClick(wc.docId, $event)"
          (mousemove)="onMouseMove(wc.docId, $event)"
          (mouseleave)="onMouseLeave()"
        >
          <!-- Hover Placeholder & Tooltip -->
          <div
            class="hover-placeholder"
            *ngIf="hoverWcId === wc.docId && hoverOffset !== null"
            [style.left.px]="hoverOffset"
            [style.width.px]="pxPerDay"
          >
            <div class="hover-tooltip">Click to add dates</div>
          </div>

          <div
            [ngClass]="'work-order-bar work-order-bar--' + order.data.status"
            [class.is-active]="activeMenuId === order.docId"
            *ngFor="let order of getOrdersForWorkCenter(wc.docId); trackBy: trackByDocId"
            [ngStyle]="getBarStyle(order)"
            (click)="$event.stopPropagation(); openEditPanel(order)"
            (mousemove)="$event.stopPropagation(); onMouseLeave()"
          >
            <div class="bar-content">
              <span class="order-name">{{ order.data.name }}</span>
              <span class="ds-pill" [ngClass]="'ds-pill--' + order.data.status">
                {{ order.data.status | titlecase }}
              </span>
            </div>

            <button class="actions-btn" (click)="toggleMenu(order.docId, $event)">
              <span class="dots">•••</span>
            </button>

            <!-- Actions Dropdown -->
            <div class="actions-dropdown" *ngIf="activeMenuId === order.docId">
              <button class="menu-item" (click)="activeMenuId = null">Edit</button>
              <button
                class="menu-item menu-item--danger"
                (click)="deleteOrder(order.docId, $event)"
              >
                Delete
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <app-work-order-panel
    [isOpen]="isPanelOpen"
    [workCenters]="workCenters"
    [initialData]="panelInitialData"
    [error]="overlapError"
    (close)="onClosePanel()"
    (save)="onSaveOrder($event)"
  ></app-work-order-panel>
</div>
